<head>
  <%= turbo_refreshes_with method: :morph, scroll: :preserve %>
</head>

<p style="color: green"><%= notice %></p>

<div class="container row">
    <div class="col">
      <h1>Games</h1>
    </div>

    <div class="col col-lg-2">
      <%= link_to "New game", new_game_path, class: "btn btn-primary" %>
    </div>
</div>

<div>
  <%= form_with url: games_path, method: :get, data: { turbo_action: "replace", controller: "auto-submit", turbo_permanent: "" } do |form| %>
    <div class="container row">
      <%= form.text_field :name,
                          placeholder: "Search by name",
                          value: session.dig('filters', 'name'),
                          data: { action: "auto-submit#submit" },
                          class: "col form-control form-control-dark text-bg-dark me-3" %>
      <%= form.select :platform,
                      options_for_select(Platform.all.pluck(:name, :id), session.dig('filters', 'platform')),
                      { include_blank: 'All Platforms' },
                      data: { action: "auto-submit#submit" },
                      class: "col form-control form-control-dark text-bg-dark form-select" %>
    </div>
  <% end %>
</div>

<div id="games", class="mt-3">
  <table id="games_table" class="table table-dark">
    <thead>
      <th scope="col" id="games_name">
        <%= sort_link(column: "games.name", label: "Name") %>
        <%= show_sort_indicator("name") %>
      </th>
      <th scope="col" id="games_platforms">
        <%= sort_link(column: "platforms.name", label: "Platforms") %>
        <%= show_sort_indicator("platforms.name") %>
      </th>
    </thead>

    <tbody>
      <% @games&.each do |game| %>
        <%= render game %>
      <% end %>
    </tbody>
  </table>
</div>
